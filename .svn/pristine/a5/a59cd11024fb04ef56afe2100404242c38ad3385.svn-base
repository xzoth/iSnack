/// <reference path="../resources/script/sencha-touch-all.js" />
//<debug>
Ext.Loader.setPath({
    'Ext': 'sdk/src'
});
//</debug>

Ext.application({
    name: 'iSnackApp',
    viewport: { autoMaximize: true },
    apiUri: 'http://localhost:2030/api/',
    phoneStartupScreen: '',
    tableStartupScreen: '',
    icon: '',

    //应用程序启动函数
    launch: function () {
        Ext.Viewport.setMasked({ xtype: 'loadmask', message: '应用程序正在启动......', indicator: false });
        var mainView = Ext.create('Ext.NavigationView', {

        });

        Ext.Viewport.add({
            xtype: 'tabpanel',
            fullscreen: true,
            tabBarPosition: 'bottom',
            items:
                    [
                        { title: '欢迎', iconCls: 'home', cls: 'home', padding: 10, scrollable: true, html: 'iSnack.Mobi' },
                        {
                            title: '产品列表',
                            iconCls: 'star',
                            xtype: 'container',
                            id: 'productListView',
                            defaultBackButtonText: '返回',
                            layout: 'fit',
                            items: [{
                                xtype: 'list',
                                ui: 'round',
                                emptyText: '没有数据',
                                grouped: true,
                                indexBar: false,
                                pinHeaders: false,
                                itemTpl: [
                                        '<div style="width:195px;padding-top:0;font-size:16px;font-weight:bold">{Name}</div>',
                                        '<div style="display:block;font-size:14px;font-weight:normal;color:#666">$ {Price}</div>'
                                    ].join(''),
                                store: {
                                    fields: ['ID', 'Name', 'Category', 'Price'],
                                    sorters: 'Price',
                                    groupField: 'Category',
                                    proxy: {
                                        type: 'ajax',
                                        url: iSnackApp.app.apiUri + 'Product',
                                        useDefaultXhrHeader: false,
                                        reader: { type: 'json', idProperty: 'ID' }
                                    },
                                    autoLoad: true
                                },
                                items: [
                                    {
                                        xtype: 'toolbar',
                                        items: [
                                            {
                                                xtype: 'searchfield',
                                                placeHolder: '搜索...',
                                                width: 140
                                            },
                                            { xtype: 'spacer' },
                                            {
                                                text: '新建',
                                                ui: 'confirm-round',
                                                handler: function () {
                                                    var listView = Ext.getCmp('productListView');
                                                    listView.push({
                                                        title: '新建',
                                                        padding: 10,
                                                        html: 'new'
                                                    });
                                                }
                                            }
                                        ]
                                    }
                                ],
                                listeners: {
                                    select: function (view, record) {
                                        //Ext.Msg.alert('你选择了', record.get('Name'));
                                    }
                                },
                                onItemDisclosure: function (record, item, index, e) {
                                    e.stopEvent();
                                    //Ext.Msg.alert('api', iSnackApp.app.apiUri);
                                }
                            }]
                        },
                        {
                            title: '关于',
                            iconCls: 'more',
                            badgeText: 'new',
                            scrollable: true,
                            layout: { type: 'vbox', pack: 'top', align: 'stretch' },
                            defaults: { xtype: 'button', margin: '5' },
                            items: [
                                {
                                    text: '提示框',
                                    ui: 'round',
                                    handler: function () { Ext.Msg.alert('Hey', '提示框'); }
                                },
                                {
                                    text: '输入框',
                                    ui: 'confirm-round',
                                    handler: function () {
                                        Ext.Msg.prompt('Hey', "请输入名称",
                                                            function (btn, text) {
                                                                if (btn == 'ok') {
                                                                    Ext.Msg.alert('Hey', text);
                                                                }
                                                            }
                                                        );
                                    }
                                },
                                {
                                    text: '确认框',
                                    ui: 'decline',
                                    handler: function () {
                                        Ext.Msg.confirm('Hey', '确定要**吗？',
                                            function (btn) {
                                                Ext.Msg.alert('Hey', '你点击了' + btn);
                                                if (btn == 'yes') {
                                                }
                                            }
                                        )
                                    }
                                },
                                {
                                    text: '浮动提示',
                                    ui: 'plain'
                                },
                                {
                                    text: '浮动提示',
                                    iconCls: 'add',
                                    ui: 'action'
                                },
                                {
                                    text: '浮动提示',
                                    ui: 'dark'
                                },
                                {
                                    text: '浮动提示'
                                }
                            ]
                        }
                    ]
        });


        Ext.Viewport.setMasked(false);
    },

    onUpdated: function () {
        window.location.reload();
    }
});